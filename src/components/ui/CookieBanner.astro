---
---

<div id="cookie-banner" class="fixed bottom-0 left-0 right-0 z-[9999] transition-transform duration-500 translate-y-full">
  <div class="bg-gray-950/95 backdrop-blur-lg border-t border-white/10 shadow-2xl">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 py-4 sm:py-5">
      <!-- Vista principal -->
      <div id="cookie-main" class="flex flex-col sm:flex-row items-start sm:items-center gap-4">
        <div class="flex-1">
          <div class="flex items-center gap-2 mb-1">
            <svg class="w-5 h-5 text-gold-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
            </svg>
            <h3 class="text-sm font-semibold text-white">Usamos cookies</h3>
          </div>
          <p class="text-xs text-gray-400 leading-relaxed">
            Utilizamos cookies propias y de terceros para mejorar tu experiencia, analizar el tráfico y personalizar contenidos. Puedes aceptar todas, rechazar las no esenciales o personalizar tu elección. 
            <a href="/politica-cookies" class="text-gold-500 hover:text-gold-400 underline">Más información</a>
          </p>
        </div>
        <div class="flex items-center gap-2 flex-shrink-0 w-full sm:w-auto">
          <button id="cookie-customize" class="px-3 py-2 text-xs text-gray-400 bg-white/5 border border-white/10 rounded-lg hover:bg-white/10 transition-all flex-1 sm:flex-none">
            Personalizar
          </button>
          <button id="cookie-reject" class="px-3 py-2 text-xs text-gray-300 bg-white/10 rounded-lg hover:bg-white/15 transition-all flex-1 sm:flex-none">
            Rechazar
          </button>
          <button id="cookie-accept" class="px-4 py-2 text-xs font-medium text-gray-900 bg-gold-500 rounded-lg hover:bg-gold-400 transition-all flex-1 sm:flex-none">
            Aceptar todo
          </button>
        </div>
      </div>

      <!-- Vista de personalización (oculta por defecto) -->
      <div id="cookie-customize-panel" class="hidden">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-sm font-semibold text-white">Configurar cookies</h3>
          <button id="cookie-back" class="text-xs text-gray-400 hover:text-white transition-colors flex items-center gap-1">
            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
            </svg>
            Volver
          </button>
        </div>

        <div class="space-y-3 mb-5">
          <!-- Esenciales (siempre activas) -->
          <div class="flex items-center justify-between p-3 rounded-lg bg-white/[0.02] border border-white/5">
            <div>
              <p class="text-xs font-medium text-white">Esenciales</p>
              <p class="text-[11px] text-gray-500">Necesarias para el funcionamiento básico de la tienda</p>
            </div>
            <span class="text-[10px] text-emerald-400 font-medium bg-emerald-400/10 px-2 py-0.5 rounded">Siempre activas</span>
          </div>

          <!-- Analíticas -->
          <label class="flex items-center justify-between p-3 rounded-lg bg-white/[0.02] border border-white/5 cursor-pointer hover:border-white/10 transition-colors">
            <div>
              <p class="text-xs font-medium text-white">Analíticas</p>
              <p class="text-[11px] text-gray-500">Nos ayudan a entender cómo usas la tienda</p>
            </div>
            <input type="checkbox" id="cookie-analytics" class="w-4 h-4 rounded bg-dark-card border-white/20 text-gold-500 focus:ring-gold-500/50" />
          </label>

          <!-- Marketing -->
          <label class="flex items-center justify-between p-3 rounded-lg bg-white/[0.02] border border-white/5 cursor-pointer hover:border-white/10 transition-colors">
            <div>
              <p class="text-xs font-medium text-white">Marketing</p>
              <p class="text-[11px] text-gray-500">Permiten mostrarte contenido relevante y ofertas personalizadas</p>
            </div>
            <input type="checkbox" id="cookie-marketing" class="w-4 h-4 rounded bg-dark-card border-white/20 text-gold-500 focus:ring-gold-500/50" />
          </label>
        </div>

        <div class="flex justify-end gap-2">
          <button id="cookie-save" class="px-5 py-2 text-xs font-medium text-gray-900 bg-gold-500 rounded-lg hover:bg-gold-400 transition-all">
            Guardar preferencias
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  (function() {
    const CONSENT_KEY = 'cookie-consent';
    const banner = document.getElementById('cookie-banner');
    const mainView = document.getElementById('cookie-main');
    const customizePanel = document.getElementById('cookie-customize-panel');

    // Comprobar si ya hay consentimiento
    const existing = localStorage.getItem(CONSENT_KEY);
    if (existing) return; // Ya aceptó/rechazó, no mostrar

    // Mostrar banner con delay
    setTimeout(() => {
      banner?.classList.remove('translate-y-full');
    }, 1500);

    function saveConsent(consent: { essential: boolean; analytics: boolean; marketing: boolean }) {
      localStorage.setItem(CONSENT_KEY, JSON.stringify({
        ...consent,
        timestamp: Date.now(),
        version: '1.0',
      }));
      banner?.classList.add('translate-y-full');
    }

    // Aceptar todo
    document.getElementById('cookie-accept')?.addEventListener('click', () => {
      saveConsent({ essential: true, analytics: true, marketing: true });
    });

    // Rechazar no esenciales
    document.getElementById('cookie-reject')?.addEventListener('click', () => {
      saveConsent({ essential: true, analytics: false, marketing: false });
    });

    // Personalizar
    document.getElementById('cookie-customize')?.addEventListener('click', () => {
      mainView?.classList.add('hidden');
      customizePanel?.classList.remove('hidden');
    });

    // Volver
    document.getElementById('cookie-back')?.addEventListener('click', () => {
      customizePanel?.classList.add('hidden');
      mainView?.classList.remove('hidden');
    });

    // Guardar preferencias personalizadas
    document.getElementById('cookie-save')?.addEventListener('click', () => {
      const analytics = (document.getElementById('cookie-analytics') as HTMLInputElement)?.checked || false;
      const marketing = (document.getElementById('cookie-marketing') as HTMLInputElement)?.checked || false;
      saveConsent({ essential: true, analytics, marketing });
    });
  })();
</script>
