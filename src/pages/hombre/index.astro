---
/**
 * ============================================================================
 * Página: Hombre
 * ============================================================================
 * Ruta: /hombre
 * Landing page con todos los productos de hombre + navegación por categorías
 * ============================================================================
 */

import PublicLayout from '../../layouts/PublicLayout.astro';
import CategoryNav from '../../components/navigation/CategoryNav';
import ProductCard from '../../components/product/ProductCard.astro';
import { supabase } from '../../lib/supabase';
import type { Product } from '../../lib/supabase';

// Obtener ID del género hombre
const { data: gender } = await supabase
  .from('genders')
  .select('id, name')
  .eq('slug', 'hombre')
  .single();

if (!gender) {
  return Astro.redirect('/404');
}

// Obtener productos de hombre (destacados primero, luego novedades)
const { data: products, error } = await supabase
  .from('products')
  .select(`
    *,
    category:categories!products_category_id_fkey(name, slug)
  `)
  .eq('gender_id', gender.id)
  .eq('is_active', true)
  .order('featured', { ascending: false })
  .order('is_new', { ascending: false })
  .order('created_at', { ascending: false })
  .limit(24);

const productsArray = (products || []) as Product[];
---

<PublicLayout title="Hombre - Fashion Store" description="Descubre la última moda masculina">
  <div class="flex flex-col lg:flex-row min-h-screen">
    <!-- Navegación lateral -->
    <aside class="lg:sticky lg:top-20 lg:self-start">
      <CategoryNav currentGender="hombre" client:load />
    </aside>

    <!-- Contenido principal -->
    <main class="flex-1 bg-dark-bg">
      {/* Hero Banner */}
      <section class="relative py-20 px-6 overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-r from-dark-surface via-dark-bg to-dark-surface"></div>
        <div class="absolute inset-0 bg-[radial-gradient(circle_at_50%_120%,rgba(212,175,55,0.1),transparent_60%)]"></div>
        <div class="relative max-w-4xl mx-auto text-center">
          <span class="inline-block px-4 py-2 bg-white/5 border border-white/10 rounded-full text-accent-gold text-sm font-medium mb-6 backdrop-blur-sm">
            Colección Masculina
          </span>
          <h1 class="text-5xl md:text-6xl font-light mb-4 uppercase tracking-[0.2em] text-white">Hombre</h1>
          <p class="text-xl font-light text-gray-400">
            Descubre la última moda masculina
          </p>
        </div>
      </section>

      {/* Destacados */}
      <section class="py-8 px-6 bg-dark-surface border-b border-white/5">
        <div class="max-w-7xl mx-auto">
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <a 
              href="/productos?genero=hombre&categoria=novedades-hombre" 
              class="group relative h-48 bg-cover bg-center rounded-xl overflow-hidden border border-white/10"
              style="background-image: url('https://images.unsplash.com/photo-1490578474895-699cd4e2cf59?w=400&h=300&fit=crop')"
            >
              <div class="absolute inset-0 bg-black/50 group-hover:bg-black/40 transition-all flex items-center justify-center">
                <span class="text-white text-xl font-light uppercase tracking-wider">Novedades</span>
              </div>
            </a>

            <a 
              href="/productos?genero=hombre&categoria=rebajas-hombre" 
              class="group relative h-48 bg-cover bg-center rounded-xl overflow-hidden border border-white/10"
              style="background-image: url('https://images.unsplash.com/photo-1489987707025-afc232f7ea0f?w=400&h=300&fit=crop')"
            >
              <div class="absolute inset-0 bg-gradient-to-br from-accent-gold/60 to-amber-600/60 group-hover:from-accent-gold/70 group-hover:to-amber-600/70 transition-all flex items-center justify-center">
                <span class="text-white text-xl font-semibold uppercase tracking-wider">Rebajas</span>
              </div>
            </a>

            <a 
              href="/productos?genero=hombre&categoria=ropa-hombre" 
              class="group relative h-48 bg-cover bg-center rounded-xl overflow-hidden border border-white/10"
              style="background-image: url('https://images.unsplash.com/photo-1617127365659-c47fa864d8bc?w=400&h=300&fit=crop')"
            >
              <div class="absolute inset-0 bg-black/50 group-hover:bg-black/40 transition-all flex items-center justify-center">
                <span class="text-white text-xl font-light uppercase tracking-wider">Ropa</span>
              </div>
            </a>

            <a 
              href="/productos?genero=hombre&categoria=zapatos-hombre" 
              class="group relative h-48 bg-cover bg-center rounded-xl overflow-hidden border border-white/10"
              style="background-image: url('https://images.unsplash.com/photo-1549298916-b41d501d3772?w=400&h=300&fit=crop')"
            >
              <div class="absolute inset-0 bg-black/50 group-hover:bg-black/40 transition-all flex items-center justify-center">
                <span class="text-white text-xl font-light uppercase tracking-wider">Zapatos</span>
              </div>
            </a>
          </div>
        </div>
      </section>

      {/* Productos */}
      <section class="py-12 px-6">
        <div class="max-w-7xl mx-auto">
          <h2 class="text-3xl font-light mb-8 text-white uppercase tracking-wider">
            Todos los productos
          </h2>

          {productsArray.length > 0 ? (
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
              {productsArray.map((product) => (
                <ProductCard product={product} />
              ))}
            </div>
          ) : (
            <div class="text-center py-16">
              <p class="text-gray-400 text-lg">No hay productos disponibles en esta sección.</p>
              <a href="/" class="text-accent-gold hover:text-accent-gold/80 mt-4 inline-block transition-colors">
                Volver al inicio
              </a>
            </div>
          )}

          {productsArray.length >= 24 && (
            <div class="text-center mt-12">
              <button class="px-8 py-3 border border-white/20 text-white hover:bg-white/5 transition-all uppercase tracking-wider text-sm rounded-lg">
                Cargar más productos
              </button>
            </div>
          )}
        </div>
      </section>
    </main>
  </div>
</PublicLayout>
